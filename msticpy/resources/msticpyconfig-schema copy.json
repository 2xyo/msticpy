{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "http://microsoft.com/msticpyconfig-yaml.json",
    "type": "object",
    "title": "msticpy Configuration schema",
    "description": "The root schema comprises the entire JSON document.",
    "default": {},
    "additionalProperties": true,
    "definitions": {
        "arg_env_var": {
            "title": "Environment Var.",
            "description": "A value stored in an environment variable.",
            "type": "string"
        },
        "arg_key_vault": {
            "title": "Key Vault Value",
            "description": "Using Key Vault with no value will use the a default path. You can specify a secret name and a vault/secret combination.",
            "type": "string"
        },
        "env_key" : {
            "type": "object",
            "properties": {
                "EnvironmentVar": {
                    "title": "Environment Var.",
                    "description": "A value stored in an environment variable.",
                    "type": "string"
                }
            }
        },
        "kv_key" : {
            "type": "object",
            "properties": {
                "KeyVault": {
                    "title": "Key Vault Value",
                    "description": "Using Key Vault with no value will use the a default path. You can specify a secret name and a vault/secret combination.",
                    "type": "string"
                }
            }
        },
        "auth_key": {
            "title": "Authentication Key",
            "description": "Secret key - string, environment variable or Key Vault secret.",
            "default": "",
            "oneOf": [
                { "type": ["string", "object"] },
                { "$ref": "#/definitions/env_key" },
                { "$ref": "#/definitions/kv_key" }
            ]
        },
        "app_id": {
            "title": "Authentication ID",
            "description": "Account identifier for service.",
            "default": "",
            "oneOf": [
                {
                    "type": "string"
                },
                {
                    "$ref": "#/definitions/arg_env_var"
                },
                {
                    "$ref": "#/definitions/arg_key_vault"
                }
            ]
        },
        "client_id": {
            "title": "Client AppID",
            "description": "Application identifier for Azure service.",
            "$ref": "#/definitions/guid"
        },
        "client_secret": {
            "title": "App Client Secret",
            "description": "Authentication secret for Azure AppID.",
            "default": "",
            "oneOf": [
                {
                    "type": "string"
                },
                {
                    "$ref": "#/definitions/arg_env_var"
                },
                {
                    "$ref": "#/definitions/arg_key_vault"
                }
            ]
        },
        "tenant_id": {
            "title": "Tenant ID of client App",
            "description": "Tenant ID of the Azure service.",
            "$ref": "#/definitions/guid"
        },
        "workspace_id": {
            "title": "Azure Sentinel TI Workspace ID",
            "description": "Workspace ID to use for Azure Sentinel TI Log Analytics connection.",
            "$ref": "#/definitions/guid"
        },
        "args_gen": {
            "type": "array",
            "title": "Args Schema",
            "description": "Specify arguments for the provider.",
            "default": {},
            "examples": [
                {
                    "AuthKey": "987654321"
                }
            ],
            "additionalProperties": true,
            "properties": {
                "AuthKey": {
                    "$ref": "#/definitions/auth_key"
                },
                "AppID": {
                    "$ref": "#/definitions/app_id"
                }
            }
        },
        "args_azcli": {
            "type": "array",
            "title": "The Args Schema for Azure CLI",
            "description": "Specify arguments for the provider.",
            "default": {},
            "examples": [
                {
                    "AuthKey": "987654321"
                }
            ],
            "additionalProperties": true,
            "properties": {
                "clientId": {
                    "$ref": "#/definitions/client_id"
                },
                "clientSecret": {
                    "$ref": "#/definitions/client_secret"
                },
                "tenantId": {
                    "$ref": "#/definitions/tenant_id"
                }
            }
        },
        "args_azti": {
            "type": "array",
            "title": "The Args Schema for Azure Sentinel TI Provider",
            "description": "Specify arguments for the provider.",
            "default": {},
            "examples": [
                {
                    "AuthKey": "987654321"
                }
            ],
            "additionalProperties": true,
            "properties": {
                "TenantID": {
                    "$ref": "#/definitions/tenant_id"
                },
                "WorkspaceID": {
                    "$ref": "#/definitions/workspace_id"
                }
            }
        },
        "guid": {
            "type": "string",
            "pattern": "^{[A-Fa-f0-9]{8}-([A-Fa-f0-9]{4}-){3}[A-Fa-f0-9]{12}}$"
        },
        "provider": {
            "type": "object",
            "title": "Provider Schema",
            "description": "Generic provider parameters schema.",
            "additionalProperties": true,
            "properties": {
                "Provider": {
                    "type": "string",
                    "enum": [
                        "OTX",
                        "VirusTotal",
                        "XForce",
                        "OPR",
                        "TOR",
                        "AzSTI"
                    ],
                    "title": "The Provider Class",
                    "description": "The name of the provider class.",
                    "default": "",
                    "examples": [
                        "OTX"
                    ]
                }
            }
        },
        "tiprovider": {
            "type": "object",
            "title": "TI Provider Schema",
            "description": "TI Provider parameters definitions.",
            "default": {},
            "examples": [
                {
                    "Provider": "OTX",
                    "Primary": true,
                    "Args": {
                        "AuthKey": "987654321"
                    }
                }
            ],
            "additionalProperties": true,
            "required": [
                "Primary",
                "Provider"
            ],
            "allOf": [
                {
                    "$ref": "#/definitions/provider"
                },
                {
                    "properties": {
                        "Primary": {
                            "type": "boolean",
                            "title": "Primary TIProvider",
                            "description": "If True this provider is a default provider.",
                            "default": false,
                            "examples": [
                                true
                            ]
                        },
                        "Provider": {
                            "type": "string",
                            "enum": [
                                "OTX",
                                "VirusTotal",
                                "XForce",
                                "OPR",
                                "TOR",
                                "AzSTI"
                            ],
                            "title": "The Provider Class",
                            "description": "The name of the provider class.",
                            "default": "",
                            "examples": [
                                "OTX"
                            ]
                        }
                    }
                }
            ],
            "if": {
                "properties": {
                    "Provider": {
                        "const": "AzSTI"
                    }
                }
            },
            "then": {
                "properties": {
                    "Args": {
                        "$ref": "#/definitions/args_azti"
                    }
                }
            },
            "else": {
                "properties": {
                    "Args": {
                        "$ref": "#/definitions/args_gen"
                    }
                }
            }
        },
        "azure_sentinel_ws": {
            "type": "object",
            "title": "Azure Sentinel Workspace Schema",
            "description": "Parameters for connecting to Azure Sentinel Workspace.",
            "default": {},
            "examples": [
                {
                    "WorkspaceId": "52b1ab41-869e-4138-9e40-2a4457f09bf3",
                    "TenantId": "72f988bf-86f1-41af-91ab-2d7cd011db49",
                    "Args": {
                        "AppID": "72f988bf-86f1-41af-91ab-2d7cd011db49",
                        "AppSecret": "72f988bf-86f1-41af-91ab-2d7cd011db49"
                    }
                }
            ],
            "additionalProperties": true,
            "required": [
                "WorkspaceId",
                "TenantId"
            ],
            "properties": {
                "WorkspaceId": {
                    "$ref": "#/definitions/workspace_id"
                },
                "TenantId": {
                    "$ref": "#/definitions/tenant_id"
                },
                "SubscriptionId": {
                    "$ref": "#/definitions/guid"
                },
                "Args": {
                    "$ref": "#/definitions/args_gen"
                }
            }
        }
    },
    "properties": {
        "AzureSentinel": {
            "type": "object",
            "title": "The AzureSentinel Workspaces Schema",
            "description": "Definitions for one or more Workspaces.",
            "default": {},
            "examples": [
                {
                    "Workspaces": {
                        "MyTestWS": {
                            "WorkspaceId": "a927809c-8142-43e1-96b3-4ad87cfe95a3",
                            "TenantId": "69d28fd7-42a5-48bc-a619-af56397b9f28"
                        },
                        "Default": {
                            "TenantId": "72f988bf-86f1-41af-91ab-2d7cd011db49",
                            "WorkspaceId": "52b1ab41-869e-4138-9e40-2a4457f09bf3"
                        }
                    }
                }
            ],
            "additionalProperties": true,
            "required": [
                "Workspaces"
            ],
            "properties": {
                "Workspaces": {
                    "type": "object",
                    "title": "Azure Sentinel Workspaces Schema",
                    "description": "One or more Workspace definitions.",
                    "default": {},
                    "additionalProperties": {
                        "$ref": "#/definitions/azure_sentinel_ws"
                    },
                    "uniqueItems": true,
                    "required": [
                        "Default"
                    ],
                    "properties" : {
                        "Default": {
                            "type": "object",
                            "title": "The default workspace",
                            "allOf": [
                                { "$ref": "#/definitions/azure_sentinel_ws" }
                            ]
                        }
                    }
                }
            }
        },
        "QueryDefinitions": {
            "type": "object",
            "title": "The Querydefinitions Schema",
            "description": "Contains paths for default and custom query templates.",
            "default": {},
            "examples": [
                {
                    "Default": [
                        "c:\\appdata\\msticpyqueries"
                    ],
                    "Custom": [
                        "c:\\users\\suri\\queries1",
                        "c:\\users\\suri\\other_queries"
                    ]
                }
            ],
            "additionalProperties": false,
            "properties": {
                "Default": {
                    "type": "array",
                    "title": "The Default Queries Path",
                    "description": "This overrides the builtin path from where to load queries.",
                    "default": [],
                    "examples": [
                        [
                            "- /home/suri/def_queries"
                        ]
                    ],
                    "items": {
                        "type": "string"
                    }
                },
                "Custom": {
                    "type": "array",
                    "title": "Custom Query Definitions Paths",
                    "description": "Additional paths from where to load queries.",
                    "default": [],
                    "examples": [
                        [
                            "- /home/suri/queries",
                            "- /home/suri/queries2"
                        ]
                    ],
                    "additionalItems": true,
                    "items": {
                        "type": "string"
                    }
                }
            }
        },
        "TIProviders": {
            "type": "array",
            "title": "TI Providers Definitions",
            "description": "TI Providers definitions.",
            "default": {},
            "examples": [
                {
                    "OTX": {
                        "Provider": "OTX",
                        "Primary": true,
                        "Args": {
                            "AuthKey": "987654321"
                        }
                    },
                    "TorExitNodes": {
                        "Provider": "Tor",
                        "Primary": true
                    }
                }
            ],
            "uniqueItems": true,
            "items": {
                "$ref": "#/definitions/ti_provider"
            }
        },
        "OtherProviders": {
            "type": "object",
            "title": "Other Providers Schema",
            "description": "Other providers parameter definitions.",
            "default": {},
            "examples": [
                {
                    "GeoIPLite": {
                        "Args": {
                            "AuthKey": {
                                "EnvironmentVar": "MAXMIND_AUTH"
                            },
                            "DBFolder": "~/.msticpy"
                        },
                        "Provider": "GeoLiteLookup"
                    },
                    "IPStack": {
                        "Args": {
                            "AuthKey": "987654321-222"
                        },
                        "Provider": "IPStackLookup"
                    }
                }
            ],
            "additionalProperties": true,
            "items": {
                "$ref": "#/definitions/provider"
            },
            "uniqueItems": true,
            "properties": {
                "GeoIPLite": {
                    "type": "object",
                    "title": "The Geoiplite Schema",
                    "default": {},
                    "examples": [
                        {
                            "Args": {
                                "AuthKey": {
                                    "EnvironmentVar": "MAXMIND_AUTH"
                                },
                                "DBFolder": "~/.msticpy"
                            },
                            "Provider": "GeoLiteLookup"
                        }
                    ],
                    "additionalProperties": true,
                    "required": [
                        "Args",
                        "Provider"
                    ],
                    "properties": {
                        "Args": {
                            "allOf": [
                                {
                                    "$ref": "#/definitions/args_gen"
                                },
                                {
                                    "properties": {
                                        "DBFolder": {
                                            "type": "string",
                                            "examples": [
                                                "~/.msticpy"
                                            ]
                                        }
                                    }
                                }
                            ]
                        },
                        "Provider": {
                            "const": "GeoLiteLookup",
                            "title": "The Provider Class",
                            "description": "The name of the provider class.",
                            "default": "GeoLiteLookup"
                        }
                    }
                },
                "IPStack": {
                    "type": "object",
                    "title": "The Ipstack Schema",
                    "default": {},
                    "examples": [
                        {
                            "Provider": "IPStackLookup",
                            "Args": {
                                "AuthKey": "987654321-222"
                            }
                        }
                    ],
                    "additionalProperties": true,
                    "required": [
                        "Args",
                        "Provider"
                    ],
                    "properties": {
                        "Args": {
                            "$ref": "#/definitions/args_gen"
                        }
                    },
                    "Provider": {
                        "const": "IPStackLookup",
                        "title": "The Provider Class",
                        "description": "The name of the provider class.",
                        "default": "IPStackLookup"
                    }
                }
            }
        },
        "DataProviders": {
            "type": "object",
            "title": "The Data Providers Schema",
            "description": "Data providers parameter definitions.",
            "default": {},
            "additionalProperties": true,
            "items": {
                "$ref": "#/definitions/provider"
            },
            "uniqueItems": true,
            "properties": {
                "AzureCLI": {
                    "type": "object",
                    "title": "The Azure CLI Data Provider",
                    "default": {},
                    "additionalProperties": true,
                    "required": [
                        "Args"
                    ],
                    "properties": {
                        "Args": { "$ref": "#/definitions/args_azcli" }
                    }
                }
            }
        },
        "AzureCLI": {
            "type": "object",
            "title": "The Azure CLI Schema",
            "description": "Azure CLI parameters schema.",
            "default": {},
            "examples": [
                {
                    "Args": {
                        "tenantId": "69d28fd7-42a5-48bc-a619-af56397b2222",
                        "clientId": "69d28fd7-42a5-48bc-a619-af56397b1111",
                        "clientSecret": "69d28fd7-42a5-48bc-a619-af56397b3333"
                    }
                }
            ],
            "additionalProperties": true,
            "required": [
                "Args"
            ],
            "properties": {
                "Args": {
                    "$ref": "#/definitions/args_azcli"
                }
            }
        }
    }
}